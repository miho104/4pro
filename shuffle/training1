const cupPositions = [
    { top: 0, left: -50 },
    { top: 400, left: -500 },
    { top: 400, left: 420 }
  ];
  
  const params = new URLSearchParams(window.location.search);
  const videoId = params.get("videoId");
  document.getElementById("video-frame").src = https://www.youtube.com/embed/${videoId}?autoplay=1&controls=1;
  
  const cups = document.querySelectorAll(".cup");
  let cupOrder = [0, 1, 2]; // è«–ç†çš„ãªé †ç•ª
  let ballIndex = Math.floor(Math.random() * cups.length);
  const message = document.getElementById("message");
  let swapCount = 5;
  
  // ã‚«ãƒƒãƒ—ã®åˆæœŸé…ç½®ã‚’è¨­å®š
  window.addEventListener("load", () => {
    const container = document.getElementById("cups-container");
    container.style.position = "relative";
  
    cups.forEach((cup, i) => {
      const pos = cupPositions[i];
      cup.style.position = "absolute";
      cup.style.top = ${pos.top}px;
      cup.style.left = ${pos.left}px;
    });
  
    // èµ¤ã„ã‚«ãƒƒãƒ—ã‚’è¡¨ç¤º
    cups[ballIndex].style.backgroundColor = "red";
    message.textContent = "èµ¤ã„ã‚«ãƒƒãƒ—ã‚’è¦šãˆã¦ãã ã•ã„... 3ç§’å¾Œã«æ¶ˆãˆã¾ã™";
  
    setTimeout(() => {
      cups.forEach(cup => cup.style.backgroundColor = "gray");
      message.textContent = "ã‚·ãƒ£ãƒƒãƒ•ãƒ«ä¸­...ä¸­å¤®ã«æ³¨è¦–ã—ã¦ãã ã•ã„";
      shuffleCups(swapCount);
    }, 3000);
  });
  
  function shuffleCups(count) {
    if (count === 0) {
      message.textContent = "ã©ã®ã‚«ãƒƒãƒ—ãŒèµ¤ã ã£ãŸã‹ã‚’é¸ã‚“ã§ãã ã•ã„";
      enableCupClick();
      return;
    }
  
    let [a, b] = getTwoDifferentIndexes();
  
    // è«–ç†é †åºã‚’ã‚¹ãƒ¯ãƒƒãƒ—
    [cupOrder[a], cupOrder[b]] = [cupOrder[b], cupOrder[a]];
  
    // è¡¨ç¤ºä½ç½®ã‚’æ›´æ–°
    cups.forEach((cup, i) => {
      const pos = cupPositions[cupOrder.indexOf(i)];
      cup.style.transition = "top 0.5s ease, left 0.5s ease";
      cup.style.top = ${pos.top}px;
      cup.style.left = ${pos.left}px;
    });
  
    // ballIndex ã‚‚å…¥ã‚Œæ›¿ãˆã«åˆã‚ã›ã¦æ›´æ–°
    //ballIndex = cupOrder.indexOf(ballIndex);
  
    setTimeout(() => shuffleCups(count - 1), 700);
  }
  
  function getTwoDifferentIndexes() {
    let a = Math.floor(Math.random() * cups.length);
    let b;
    do {
      b = Math.floor(Math.random() * cups.length);
    } while (b === a);
    return [a, b];
  }
  
  function enableCupClick() {
    cups.forEach((cup, i) => {
      cup.addEventListener("click", () => {
        if (i === ballIndex) {
          cup.style.backgroundColor = "red";
          message.textContent = "æ­£è§£ï¼ ğŸ‰";
        } else {
          message.textContent = ä¸æ­£è§£... æ­£è§£ã¯ ${ballIndex + 1} ç•ªã®ã‚«ãƒƒãƒ—ã§ã—ãŸ;
          cups[ballIndex].style.backgroundColor = "red";
        }
      }, { once: true });
    });
  }
  